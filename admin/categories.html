<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categories - Redstone Admin</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Admin CSS -->
    <link rel="stylesheet" href="../css/admin.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1><span>REDSTONE</span> ADMIN</h1>
        </div>

        <nav class="sidebar-nav">
            <a href="index.html" class="nav-item">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a href="products.html" class="nav-item">
                <i class="fas fa-box"></i>
                <span>Products</span>
            </a>
            <a href="orders.html" class="nav-item">
                <i class="fas fa-shopping-bag"></i>
                <span>Orders</span>
            </a>
            <a href="customers.html" class="nav-item">
                <i class="fas fa-users"></i>
                <span>Customers</span>
            </a>
            <a href="categories.html" class="nav-item active">
                <i class="fas fa-tags"></i>
                <span>Categories</span>
            </a>
            <a href="settings.html" class="nav-item">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <a href="../index.html" class="nav-item">
                <i class="fas fa-store"></i>
                <span>View Store</span>
            </a>
            <a href="#" class="nav-item" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar -->
        <header class="top-bar">
            <button class="menu-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>

            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search categories..." id="search-input" oninput="searchCategories()">
            </div>

            <div class="top-bar-actions">
                <button class="icon-btn">
                    <i class="fas fa-bell"></i>
                    <span class="badge">3</span>
                </button>

                <div class="user-menu">
                    <img src="https://ui-avatars.com/api/?name=Admin&background=7800ff&color=fff" alt="Admin">
                    <span>Admin</span>
                </div>
            </div>
        </header>

        <!-- Categories Content -->
        <div class="content">
            <div class="page-header">
                <div>
                    <h1>Categories</h1>
                    <p>Manage product categories</p>
                </div>
                <button class="btn btn-primary" onclick="openCategoryModal()">
                    <i class="fas fa-plus"></i> Add Category
                </button>
            </div>

            <!-- Categories Grid -->
            <div class="categories-grid" id="categories-grid">
                <!-- Loaded by JS -->
            </div>
        </div>
    </main>

    <!-- Category Modal -->
    <div class="modal" id="category-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Add Category</h2>
                <button class="modal-close" onclick="closeCategoryModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="category-form" onsubmit="saveCategory(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Category Name *</label>
                        <input type="text" class="form-input" id="category-name" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Slug</label>
                        <input type="text" class="form-input" id="category-slug" placeholder="auto-generated">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-textarea" id="category-description" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Icon (Font Awesome class)</label>
                        <input type="text" class="form-input" id="category-icon" placeholder="fas fa-tag">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Image URL</label>
                        <input type="url" class="form-input" id="category-image" placeholder="https://example.com/image.jpg">
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="category-active" checked>
                            <span>Active</span>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeCategoryModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Category</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="delete-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Delete Category</h2>
                <button class="modal-close" onclick="closeDeleteModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this category? Products in this category will become uncategorized.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Admin JS -->
    <script src="../js/admin.js"></script>
    <script>
        // Check authentication
        checkAuth();

        let currentCategories = [];
        let editingCategoryId = null;
        let deletingCategoryId = null;

        document.addEventListener('DOMContentLoaded', function() {
            loadCategories();

            // Auto-generate slug from name
            document.getElementById('category-name').addEventListener('input', function() {
                const slug = this.value.toLowerCase()
                    .replace(/[^a-z0-9]+/g, '-')
                    .replace(/(^-|-$)/g, '');
                document.getElementById('category-slug').value = slug;
            });
        });

        function loadCategories() {
            let categories = JSON.parse(localStorage.getItem('adminCategories') || '[]');

            // If no categories, create default ones
            if (categories.length === 0) {
                categories = getDefaultCategories();
                localStorage.setItem('adminCategories', JSON.stringify(categories));
            }

            currentCategories = categories;
            renderCategories();
        }

        function getDefaultCategories() {
            return [
                {
                    id: 1,
                    name: 'Electronics',
                    slug: 'electronics',
                    description: 'Smartphones, laptops, gadgets and more',
                    icon: 'fas fa-laptop',
                    image: 'https://images.unsplash.com/photo-1498049794561-7780e7231661?w=400',
                    active: true,
                    productsCount: 0
                },
                {
                    id: 2,
                    name: 'Fashion',
                    slug: 'fashion',
                    description: 'Clothing, shoes, and accessories',
                    icon: 'fas fa-tshirt',
                    image: 'https://images.unsplash.com/photo-1445205170230-053b83016050?w=400',
                    active: true,
                    productsCount: 0
                },
                {
                    id: 3,
                    name: 'Digital Products',
                    slug: 'digital',
                    description: 'Software, courses, ebooks and templates',
                    icon: 'fas fa-download',
                    image: 'https://images.unsplash.com/photo-1432888498266-38ffec3eaf0a?w=400',
                    active: true,
                    productsCount: 0
                },
                {
                    id: 4,
                    name: 'Home & Living',
                    slug: 'home',
                    description: 'Furniture, decor and home essentials',
                    icon: 'fas fa-home',
                    image: 'https://images.unsplash.com/photo-1484101403633-562f891dc89a?w=400',
                    active: true,
                    productsCount: 0
                },
                {
                    id: 5,
                    name: 'Sports',
                    slug: 'sports',
                    description: 'Sports equipment and fitness gear',
                    icon: 'fas fa-futbol',
                    image: 'https://images.unsplash.com/photo-1461896836934- voices-voices?w=400',
                    active: true,
                    productsCount: 0
                },
                {
                    id: 6,
                    name: 'Beauty',
                    slug: 'beauty',
                    description: 'Cosmetics, skincare and personal care',
                    icon: 'fas fa-spa',
                    image: 'https://images.unsplash.com/photo-1596462502278-27bfdc403348?w=400',
                    active: true,
                    productsCount: 0
                }
            ];
        }

        function searchCategories() {
            renderCategories();
        }

        function renderCategories() {
            const search = document.getElementById('search-input').value.toLowerCase();
            let filtered = currentCategories;

            if (search) {
                filtered = currentCategories.filter(c =>
                    c.name.toLowerCase().includes(search) ||
                    c.description?.toLowerCase().includes(search)
                );
            }

            // Count products per category
            const products = JSON.parse(localStorage.getItem('adminProducts') || '[]');
            filtered = filtered.map(cat => ({
                ...cat,
                productsCount: products.filter(p => p.category === cat.slug).length
            }));

            const grid = document.getElementById('categories-grid');

            if (filtered.length === 0) {
                grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #888; grid-column: 1/-1;">No categories found</p>';
                return;
            }

            grid.innerHTML = filtered.map(category => `
                <div class="category-card ${!category.active ? 'inactive' : ''}">
                    <div class="category-image">
                        ${category.image
                            ? `<img src="${category.image}" alt="${category.name}">`
                            : `<i class="${category.icon || 'fas fa-tag'}"></i>`
                        }
                    </div>
                    <div class="category-info">
                        <h3>${category.name}</h3>
                        <p>${category.description || 'No description'}</p>
                        <div class="category-meta">
                            <span><i class="fas fa-box"></i> ${category.productsCount} products</span>
                            <span class="status-badge status-${category.active ? 'active' : 'inactive'}">
                                ${category.active ? 'Active' : 'Inactive'}
                            </span>
                        </div>
                    </div>
                    <div class="category-actions">
                        <button class="action-btn" onclick="editCategory(${category.id})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn action-btn-danger" onclick="deleteCategory(${category.id})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function openCategoryModal(categoryId = null) {
            editingCategoryId = categoryId;
            const modal = document.getElementById('category-modal');
            const title = document.getElementById('modal-title');
            const form = document.getElementById('category-form');

            form.reset();
            document.getElementById('category-active').checked = true;

            if (categoryId) {
                title.textContent = 'Edit Category';
                const category = currentCategories.find(c => c.id === categoryId);
                if (category) {
                    document.getElementById('category-name').value = category.name;
                    document.getElementById('category-slug').value = category.slug;
                    document.getElementById('category-description').value = category.description || '';
                    document.getElementById('category-icon').value = category.icon || '';
                    document.getElementById('category-image').value = category.image || '';
                    document.getElementById('category-active').checked = category.active;
                }
            } else {
                title.textContent = 'Add Category';
            }

            modal.classList.add('active');
        }

        function closeCategoryModal() {
            document.getElementById('category-modal').classList.remove('active');
            editingCategoryId = null;
        }

        function saveCategory(e) {
            e.preventDefault();

            const category = {
                id: editingCategoryId || Date.now(),
                name: document.getElementById('category-name').value,
                slug: document.getElementById('category-slug').value || document.getElementById('category-name').value.toLowerCase().replace(/[^a-z0-9]+/g, '-'),
                description: document.getElementById('category-description').value,
                icon: document.getElementById('category-icon').value,
                image: document.getElementById('category-image').value,
                active: document.getElementById('category-active').checked
            };

            if (editingCategoryId) {
                const index = currentCategories.findIndex(c => c.id === editingCategoryId);
                if (index !== -1) {
                    currentCategories[index] = { ...currentCategories[index], ...category };
                }
            } else {
                currentCategories.push(category);
            }

            localStorage.setItem('adminCategories', JSON.stringify(currentCategories));
            closeCategoryModal();
            renderCategories();
            showToast(editingCategoryId ? 'Category updated successfully' : 'Category added successfully', 'success');
        }

        function editCategory(id) {
            openCategoryModal(id);
        }

        function deleteCategory(id) {
            deletingCategoryId = id;
            document.getElementById('delete-modal').classList.add('active');
        }

        function closeDeleteModal() {
            document.getElementById('delete-modal').classList.remove('active');
            deletingCategoryId = null;
        }

        function confirmDelete() {
            if (deletingCategoryId) {
                currentCategories = currentCategories.filter(c => c.id !== deletingCategoryId);
                localStorage.setItem('adminCategories', JSON.stringify(currentCategories));
                closeDeleteModal();
                renderCategories();
                showToast('Category deleted successfully', 'success');
            }
        }
    </script>

    <style>
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .category-card {
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .category-card:hover {
            border-color: rgba(120, 0, 255, 0.5);
            transform: translateY(-2px);
        }

        .category-card.inactive {
            opacity: 0.6;
        }

        .category-image {
            height: 150px;
            background: linear-gradient(135deg, rgba(120, 0, 255, 0.2), rgba(0, 212, 255, 0.2));
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .category-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .category-image i {
            font-size: 3rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .category-info {
            padding: 20px;
        }

        .category-info h3 {
            font-size: 1.25rem;
            margin-bottom: 8px;
        }

        .category-info p {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .category-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.85rem;
        }

        .category-meta span:first-child {
            color: #888;
        }

        .category-meta i {
            margin-right: 5px;
        }

        .category-actions {
            display: flex;
            gap: 10px;
            padding: 15px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
        }

        .status-badge.status-active {
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
        }

        .status-badge.status-inactive {
            background: rgba(255, 107, 107, 0.1);
            color: #ff6b6b;
        }
    </style>
</body>
</html>
